# 网络分析工具

## ping（Packet Internet Groper）

- 属于一个通讯协议，是TCP/IP的一部分
- 检查网络是否联通
- 发送一个ICMP（Internet Control Messages Protocol）（因特网信报控制协议）

步骤：

- 使用 ipconfig/all 观察本地网络是否设置正确
- ping 127.0.0.1 检查本地 TCP/IP 协议有没有设置好
- ping 本机ip地址，检查本机ip
- ping 本网网关地址
- ping 本地DNS地址
- ping 远程目标地址

## tcpdump

- 可以将网络中传送的数据包的头截获下来分析
- 支持对协议、主机、网络或者端口进行过滤

tcpdump [ -DenNqvX ] [ -c count ] [ -F file ] [ -i interface ] [ -r file ]
        [ -s snaplen ] [ -w file ] [ expression ]

### 抓包选项：

- -c：指定要抓取的包数量。注意，是最终要获取这么多个包。例如，指定"-c 10"将获取10个包，但可能已经处理了100个包，只不过只有10个包是满足条件的包。
- -i interface：指定tcpdump需要监听的接口。若未指定该选项，将从系统接口列表中搜寻编号最小的已配置好的接口(不包括loopback接口，要抓取loopback接口使用tcpdump -i lo)，一旦找到第一个符合条件的接口，搜寻马上结束。可以使用'any'关键字表示所有网络接口。
- -n：对地址以数字方式显式，否则显式为主机名，也就是说-n选项不做主机名解析。
- -nn：除了-n的作用外，还把端口显示为数值，否则显示端口服务名。
- -N：不打印出host的域名部分。例如tcpdump将会打印'nic'而不是'nic.ddn.mil'。
- -P：指定要抓取的包是流入还是流出的包。可以给定的值为"in"、"out"和"inout"，默认为"inout"。
- -s len：设置tcpdump的数据包抓取长度为len，如果不设置默认将会是65535字节。对于要抓取的数据包较大时，长度设置不够可能会产生包截断，若出现包截断，输出行中会出现"[|proto]"的标志(proto实际会显示为协议名)。但是抓取len越长，包的处理时间越长，并且会减少tcpdump可缓存的数据包的数量，从而会导致数据包的丢失，所以在能抓取我们想要的包的前提下，抓取长度越小越好。

### 截获某主机相关的包

```
tcpdump host 210.27.48.1
```

## netstat

netstat命令是一个监控TCP/IP网络的非常有用的工具，它可以显示路由表、实际的网络连接以及每一个网络接口设备的状态信息。
语法选项

### netstat [选项]

```
-a或--all：显示所有连线中的Socket；
-A<网络类型>或--<网络类型>：列出该网络类型连线中的相关地址；
-c或--continuous：持续列出网络状态；
-C或--cache：显示路由器配置的快取信息；
-e或--extend：显示网络其他相关信息；
-F或--fib：显示FIB；
-g或--groups：显示多重广播功能群组组员名单；
-h或--help：在线帮助；
-i或--interfaces：显示网络界面信息表单；
-l或--listening：显示监控中的服务器的Socket；
-M或--masquerade：显示伪装的网络连线；
-n或--numeric：直接使用ip地址，而不通过域名服务器；
-N或--netlink或--symbolic：显示网络硬件外围设备的符号连接名称；
-o或--timers：显示计时器；
-p或--programs：显示正在使用Socket的程序识别码和程序名称；
-r或--route：显示Routing Table；
-s或--statistice：显示网络工作信息统计表；
-t或--tcp：显示TCP传输协议的连线状况；
-u或--udp：显示UDP传输协议的连线状况；
-v或--verbose：显示指令执行过程；
-V或--version：显示版本信息；
-w或--raw：显示RAW传输协议的连线状况；
-x或--unix：此参数的效果和指定"-A unix"参数相同；
--ip或--inet：此参数的效果和指定"-A inet"参数相同。
```

### 例子

- 列出所有端口情况

```
netstat -a      # 列出所有端口
netstat -at     # 列出所有TCP端口
netstat -au     # 列出所有UDP端口
```

- 列出所有处于监听状态的 Sockets

```
netstat -l   # 只显示监听端口
netstat -lt  # 显示监听TCP端口
netstat -lu  # 显示监听UDP端口
netstat -lx  # 显示监听UNIX端口
```

- 显示每个协议的统计信息

```
netstat -s     # 显示所有端口的统计信息
netstat -st    # 显示所有TCP的统计信息
etstat -su    # 显示所有UDP的统计信息
```

- 显示 PID 和进程名称

```
netstat -p
```

- 显示核心路由信息

```
netstat -r
netstat -rn   # 显示数字格式，不查询主机名称
```

- 查看端口和服务

```
netstat -antp | grep ssh
```