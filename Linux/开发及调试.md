# 开发及调试

## 调试工具：gdb

- run：简记为 r ，其作用是运行程序，当遇到断点后，程序会在断点处停止运行，等待用户输入下一步的命令。
- continue （简写c ）：继续执行，到下一个断点处（或运行结束）
- next：（简写 n），单步跟踪程序，当遇到函数调用时，也不进入此函数体；此命令同 step 的主要区别是，step 遇到用户自定义的函数，将步进到函数中去运行，而 next 则直接调用函数，不会进入到函数体内。
- step （简写s）：单步调试如果有函数调用，则进入函数；与命令n不同，n是不进入调用的函数的
- until：当你厌倦了在一个循环体内单步跟踪时，这个命令可以运行程序直到退出循环体。
- until+行号： 运行至某行，不仅仅用来跳出循环
- finish： 运行程序，直到当前函数完成返回，并打印函数返回时的堆栈地址和返回值及参数值等信息。
- call 函数(参数)：调用程序中可见的函数，并传递“参数”，如：call gdb_test(55)
- quit：简记为 q ，退出gdb
- break n （简写b n）:在第n行处设置断点
- list ：简记为 l ，其作用就是列出程序的源代码，默认每次显示10行。
- print 表达式：简记为 p ，其中“表达式”可以是任何当前正在被测试程序的有效表达式，比如当前正在调试C语言的程序，那么“表达式”可以是任何C语言的有效表达式，包括数字，变量甚至是函数调用。
- where/bt ：当前运行的堆栈列表；
- bt backtrace 显示当前调用堆栈

## 查看依赖库：ldd

- 命令：ldd ./server

- 可以查看可执行文件server所需的所有动态库，动态库所在目录及其被映射到的虚拟地址空间

## 二进制文件分析：objdump

## ELF文件格式分析：readelf

- 可以得到ELF文件各段内容，分析链接、符号表等需要用到

## 跟踪进程中系统调用：strace

- strace常用来跟踪进程执行时的系统调用和所接收的信号。
- Linux进程不能直接访问硬件设备，当进程需要访问硬件设备(比如读取磁盘文件，接收网络数据等等)时，必须由用户态模式切换至内核态模式，通过系统调用访问硬件设备。
- strace可以跟踪到一个进程产生的系统调用,包括参数，返回值，执行消耗的时间。

- 命令：strace ./server

- 通过上面的方式运行server程序。此时可以打印出没次系统调用及其参数等，我们也可以加-o filename将系统调用信息保存下来。

## 跟踪进程栈：pstack

## 进程内存映射：pmap

- 显示进程内存映射

```shell
# -x显示扩展信息，后接进程pid
# Address: 内存开始地址
pmap -x 12345
```

- 显示信息

```
Kbytes: 占用内存的字节数
RSS: 保留内存的字节数
Dirty: 脏页的字节数（包括共享和私有的）
Mode: 内存的权限：read、write、execute、shared、private
Mapping: 占用内存的文件、或[anon]（分配的内存）、或[stack]（堆栈）
Device: 设备名 (major:minor)
```